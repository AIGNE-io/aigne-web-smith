name: feedbackRefiner
description: Analyzes a user's specific feedback on generated documentation and refines it into a general, reusable preference rule for future use.

# The instructions file contains the core logic (the prompt) for this Agent.
instructions:
  url: ../prompts/feedback-refiner.md

input_schema:
  type: object
  properties:
    feedback:
      type: string
      description: User's original feedback
    stage:
      type: string
      description: The command/scenario that generated the feedback (used to infer scope), possible values. structure_planning, document_refine, translation_refine
    paths:
      type: array
      items:
        type: string
      description: Optional. Document paths specified by the user in the current command
    existingPreferences:
      type: string
      description: Optional. YAML format string of currently saved user preference rules, used to avoid duplicate saving of similar rules
  required: 
    - feedback
    - stage

output_schema:
  type: object
  properties:
    rule:
      type: string
      description: Refine and summarize user feedback into a general rule
    scope:
      type: string
      description: Rule scope. global, structure, document, translation
    save:
      type: boolean
      description: Whether to save as persistent preference (true=save; false=one-time, do not save)
    limitToInputPaths:
      type: boolean
      description: Whether to limit to the "paths specified in current input" when used subsequently
    reason:
      type: string
      description: Explanation of why the save decision was made and how the rule and scope were derived
  required:
    - rule
    - scope
    - save
    - limitToInputPaths
    - reason