type: team
name: generatePageDetailTeam
description: Team for generating page detail
skills:
  - ../../utils/transform-detail-datasources.mjs
  - type: team
    task_render_mode: collapse
    name: generatePageDetail
    skills:
      - url: ../../utils/find-user-preferences-by-path.mjs
        default_input:
          scope: page
      - ./generate-page-detail.yaml
      - type: transform
        jsonata: |
          $merge([
            $,
            { "reviewContent": content }
          ])
      - url: ../../utils/reload-generate-media.mjs
      - url: ../../utils/check-detail-result.mjs
        default_input:
          allowArrayFallback: true
      - url: ../../utils/fix-detail-check-errors.mjs
    reflection:
      reviewer:
        url: ../../utils/check-detail-result.mjs
        default_input:
          allowArrayFallback: true
      is_approved: isApproved
      max_iterations: 5
      return_last_on_max_iterations: true
    task_title: Generate '{{ title }}'
  - type: transform
    task_render_mode: hide
    jsonata: |
      $merge([
        $,
        { "feedback": "" }
      ])
  # will translate page detail next workflow
  # - ../../translate/translate-page-detail-team.yaml
  - url: ../../utils/save-single-page.mjs
    default_input:
      throwErrorIfInvalid: true
input_schema:
  type: object
  properties:
    locale:
      type: string
      description: Language
    glossary:
      type: string
      description: Glossary
    pagePath:
      type: string
      description: Current path
    feedback:
      type: string
      description: Feedback
    sources:
      type: array
      items:
        type: string
        description: Source code paths
    sourcesPath:
      type: array
      items:
        type: string
        description: Source code paths
      default:
        - ./
    includePatterns:
      type: array
      items:
        type: string
        description: Included file names
    excludePatterns:
      type: array
      items:
        type: string
        description: Excluded file names
    tmpDir:
      type: string
      description: Output directory
      default: ./aigne-pages/output
    pagesDir:
      type: string
      description: Pages directory
      default: ./aigne-pages/pages
    additionalInformation:
      type: string
      description: Additional supplementary information
output_schema:
  type: object
  properties:
    title:
      type: string
    description:
      type: string
    path:
      type: string
    content:
      type: string
mode: sequential
