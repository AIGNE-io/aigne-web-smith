type: team
name: translate
description: Translate page content to chosen languages
skills:
  - url: ../init/index.mjs
    default_input:
      skipIfExists: true
  - ../utils/load-config.mjs
  - ../utils/load-sources.mjs
  - type: transform
    task_render_mode: hide
    jsonata: |
      $merge([
        $,
        {
          'websiteStructure': originalWebsiteStructure
        }
      ])
  - ../utils/transform-website-structure.yaml
  - url: ../utils/choose-pages.mjs
    default_input:
      isTranslate: true
  - url: ./page-detail/choose-language.mjs
    default_input:
      requiredFeedback: true
  - type: team
    name: batchTranslatePageDetail
    skills:
      - ./page-detail/translate-page-detail-team.yaml
      - url: ../utils/save-single-page.mjs
        default_input:
          isTranslate: true
    iterate_on: selectedPages
    concurrency: 6
  - url: ../utils/check-feedback-refiner.mjs
    default_input:
      stage: translation_refine
  # trigger re-generate
  - ../generate/page-detail/load-page-detail.mjs
  - ../generate/page-data/compose-pages-data.mjs
  - ../utils/save-pages.mjs
input_schema:
  type: object
  properties:
    glossary:
      type: string
      description: Glossary of terms for consistent terminology, use @<file> to read from a file
    pages:
      type: array
      items:
        type: string
      description: Page paths to translate
    langs:
      type: array
      items:
        type: string
      description: "Languages to translate to, available languages are: en, zh, zh-TW, ja, fr, de, es, it, ru, ko, pt, ar"
    feedback:
      type: string
      description: Feedback for translation improvement
mode: sequential
